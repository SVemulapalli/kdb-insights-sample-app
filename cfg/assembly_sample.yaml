name: Example assembly
description: Sample assembly file

labels:
  region: canada,usa

# Database schema
tables:
  trade:
    description: Trade data
    type: partitioned
    blockSize: 10000
    prtnCol: realTime
    sortColsOrd: sym
    sortColsDisk: sym
    columns:
      - name: time
        description: Time
        type: timespan
      - name: sym
        description: Symbol name
        type: symbol
        attrMem: grouped
        attrDisk: parted
        attrOrd: parted
      - name: realTime
        description: Partitioning timestamp column
        type: timestamp
      - name: price
        description: Trade price
        type: float
      - name: size
        description: Trade size
        type: long

  quote:
    description: Quote data
    type: partitioned
    blockSize: 10000
    prtnCol: realTime
    sortColsOrd: sym
    sortColsDisk: sym
    columns:
      - name: time
        description: Time
        type: timespan
      - name: sym
        description: Symbol name
        type: symbol
        attrMem: grouped
        attrDisk: parted
        attrOrd: parted
      - name: realTime
        description: Partitioning timestamp column
        type: timestamp
      - name: bid
        description: Bid price
        type: float
      - name: ask
        description: Ask price
        type: float
      - name: bidSize
        description: Big size
        type: long
      - name: askSize
        description: Ask size
        type: long

  xref:
    description: TAQ reference data
    type: splayed
    primaryKeys: serial
    prtnCol: bornTS
    columns:
      - name: serial
        type: int
        attrMem: unique
      - name: nft
        description: They say these are all the rage lately!
        type: guid
      - name: factory
        type: short
      - name: batch
        type: int
      - name: machine
        type: int
      - name: bornTS
        type: timestamp


# Message bus configuration
bus:
  messages:
    protocol: custom
    nodes: tp:5010
    topic: dataStream
  stream:   
    protocol: custom
    nodes: tp:5010
    topic: dataStream

# Database mount configuration
mounts:
  rdb:
    type: stream
    baseURI: file:///mnt/foo/i/
    partition: none
  idb:
    type: local
    baseURI: file:///data/db/idb
    partition: ordinal
  hdb:
    type: local
    baseURI: file:///data/db/hdb
    partition: date

# Service configuration
elements:
  rc:
    host: sgrc
    port: 5060
    timeout: 30000
  
  # SM configuration (also used by EOI, EOD, and DBM)
  sm:
    description: Storage manager
    source: stream
    # Tier configuration
    tiers:
      - name: stream
        mount: rdb
      - name: idb
        mount: idb
        schedule:
          freq: 0D00:10:00 # every 10 minutes
      - name: hdb1
        mount: hdb
        schedule:
          freq: 1D00:00:00 # every day
          snap:   01:35:00 # at 1:35 AM
        retain:
          time: 2 days
          rows: 200000
      - name: hdb2
        mount: hdb
        store: file:///data/db/hdbtier2
        retain:
          time: 5 weeks
          size: 2 TB
          rows: 10000000
      - name: hdb3
        mount: hdb
        store: file:///data/db/hdbtier3
        retain:
          time: 3 months
          size: 10 TB
          rows: 20000000
##      - name: hist4
 ##       mount: hdb
 ##       store: s3://hdbtier3/
   ##     retain:
   ##       time: 1 year
  ##        size: 1 PB
##          rows: 20000000          
    disableDiscovery: true  # Disables registering with discovery
  dap:
    gwAssembly: gw-assembly
    smEndpoints: sm:10001
    instances:
      RDB:
        mountName: rdb
      IDB:
        mountName: idb
      HDB:
        mountName: hdb